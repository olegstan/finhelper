{"version":3,"file":"GroupArchiveHelper.js","names":["ActiveConstants","ActiveModel","AccountConstants","GroupHelper","GroupArchiveHelper","prepareActives","actives","groupType","modelClass","activeSortedItems","sortedItems","activeSubIndex","map","item","subkey","item_id","item_type","name_text","indexOf","push","keyId","attributes","create","buy_trades","sell_trades","trade","BY_TYPE","BY_GROUP","BY_ACCOUNT","activeIndex","isPackage","type_id","account","getAccountBySubAccountId","from_account_id","key","id","CURRENCY","to_account_id","buy_account_id","buy_account_idd","setValuation","setPaidSum","group","e","console","log"],"sources":["../../../src/helpers/Group/GroupArchiveHelper.js"],"sourcesContent":["import ActiveConstants from \"../../constants/ActiveConstants\"\r\nimport ActiveModel from \"../../models/Active\"\r\nimport AccountConstants from \"../../constants/AccountConstants\"\r\nimport GroupHelper from \"./GroupHelper\";\r\n\r\nclass GroupArchiveHelper\r\n{\r\n  /**\r\n   *\r\n   * @param actives\r\n   * @param groupType\r\n   * @param modelClass\r\n   * @returns {*[]}\r\n   */\r\n  static prepareActives(actives, groupType, modelClass = ActiveModel)\r\n  {\r\n    try\r\n    {\r\n      let activeSortedItems = [];\r\n\r\n      let sortedItems = [];\r\n      let activeSubIndex = [];\r\n\r\n      actives.map((item) =>\r\n      {\r\n        let subkey = item.item_id ? item.item_type + '.' + item.item_id : item.name_text;\r\n\r\n        if (activeSubIndex.indexOf(subkey) === -1)\r\n        {\r\n          activeSubIndex.push(subkey);\r\n        }\r\n\r\n        let keyId = activeSubIndex.indexOf(subkey)\r\n        item.keyId = keyId;\r\n        item.attributes.keyId = keyId;\r\n\r\n        if (typeof activeSortedItems[keyId] === 'undefined')\r\n        {\r\n          activeSortedItems[keyId] = modelClass.create({...item.attributes});\r\n\r\n          activeSortedItems[keyId].attributes.buy_trades = [];\r\n          activeSortedItems[keyId].attributes.sell_trades = [];\r\n        }\r\n\r\n        item.attributes?.buy_trades?.map((trade) =>\r\n        {\r\n          activeSortedItems[keyId].attributes.buy_trades.push({...trade})\r\n        })\r\n\r\n        item.attributes?.sell_trades?.map((trade) =>\r\n        {\r\n          activeSortedItems[keyId].attributes.sell_trades.push({...trade})\r\n        })\r\n      });\r\n\r\n      if (groupType === ActiveConstants.BY_TYPE)\r\n      {\r\n        sortedItems = activeSortedItems;\r\n      } else if (groupType === ActiveConstants.BY_GROUP)\r\n      {\r\n        sortedItems = activeSortedItems;\r\n      } else if (groupType === ActiveConstants.BY_ACCOUNT)\r\n      {\r\n        let activeIndex = [];\r\n\r\n        activeSortedItems.map((item) =>\r\n        {\r\n          if (ActiveConstants.isPackage(item.type_id))\r\n          {\r\n            item.attributes?.buy_trades?.map((trade) =>\r\n            {\r\n              let account = AccountConstants.getAccountBySubAccountId(trade.from_account_id);\r\n\r\n              let key = item.id + (account ? account.id : 'none');\r\n\r\n              if (activeIndex.indexOf(key) === -1)\r\n              {\r\n                activeIndex.push(key);\r\n              }\r\n\r\n              let keyId = activeIndex.indexOf(key)\r\n              item.keyId = keyId;\r\n              item.attributes.keyId = keyId;\r\n\r\n              if (typeof sortedItems[keyId] === 'undefined')\r\n              {\r\n                sortedItems[keyId] = modelClass.create({...item.attributes});\r\n\r\n                sortedItems[keyId].attributes.buy_trades = [];\r\n                sortedItems[keyId].attributes.sell_trades = [];\r\n              }\r\n            });\r\n\r\n            item.attributes?.sell_trades?.map((trade) =>\r\n            {\r\n              let account;\r\n\r\n              if (item.type_id === ActiveConstants.CURRENCY)\r\n              {\r\n                account = AccountConstants.getAccountBySubAccountId(trade.to_account_id);\r\n              } else\r\n              {\r\n                account = AccountConstants.getAccountBySubAccountId(trade.from_account_id);\r\n              }\r\n\r\n\r\n              let key = item.id + (account ? account.id : 'none');\r\n\r\n              if (activeIndex.indexOf(key) === -1)\r\n              {\r\n                activeIndex.push(key);\r\n              }\r\n\r\n              let keyId = activeIndex.indexOf(key)\r\n              item.keyId = keyId;\r\n              item.attributes.keyId = keyId;\r\n\r\n              if (typeof sortedItems[keyId] === 'undefined')\r\n              {\r\n                sortedItems[keyId] = modelClass.create({...item.attributes});\r\n\r\n                sortedItems[keyId].attributes.buy_trades = [];\r\n                sortedItems[keyId].attributes.sell_trades = [];\r\n              }\r\n            });\r\n\r\n            item.attributes?.buy_trades?.map((trade) =>\r\n            {\r\n              let account = AccountConstants.getAccountBySubAccountId(trade.from_account_id);\r\n\r\n              let key = item.id + (account ? account.id : 'none');\r\n\r\n              let keyId = activeIndex.indexOf(key)\r\n\r\n              sortedItems[keyId].attributes.buy_trades.push({...trade});\r\n            });\r\n\r\n\r\n            item.attributes?.sell_trades?.map((trade) =>\r\n            {\r\n              let account;\r\n\r\n              if (item.type_id === ActiveConstants.CURRENCY)\r\n              {\r\n                account = AccountConstants.getAccountBySubAccountId(trade.to_account_id);\r\n              } else\r\n              {\r\n                account = AccountConstants.getAccountBySubAccountId(trade.from_account_id);\r\n              }\r\n\r\n              let key = item.id + (account ? account.id : 'none');\r\n\r\n              let keyId = activeIndex.indexOf(key)\r\n\r\n              sortedItems[keyId].attributes.sell_trades.push({...trade});\r\n            });\r\n          } else\r\n          {\r\n            let key = item.id + 'none';\r\n\r\n            if (item.buy_account_id)\r\n            {\r\n              let account = AccountConstants.getAccountBySubAccountId(item.buy_account_idd);\r\n\r\n              key = item.id + (account ? account.id : 'none');\r\n            }\r\n\r\n            if (activeIndex.indexOf(key) === -1)\r\n            {\r\n              activeIndex.push(key);\r\n            }\r\n\r\n            let keyId = activeIndex.indexOf(key)\r\n            item.keyId = keyId;\r\n            item.attributes.keyId = keyId;\r\n\r\n            if (typeof sortedItems[keyId] === 'undefined')\r\n            {\r\n              sortedItems[keyId] = modelClass.create({...item.attributes});\r\n\r\n              sortedItems[keyId].attributes.buy_trades = [];\r\n              sortedItems[keyId].attributes.sell_trades = [];\r\n            }\r\n          }\r\n        });\r\n\r\n        GroupHelper.setValuation(sortedItems);\r\n        GroupHelper.setPaidSum(sortedItems);\r\n      }\r\n\r\n      return GroupHelper.group(sortedItems, groupType);\r\n    } catch (e)\r\n    {\r\n      console.log(e)\r\n      return []\r\n    }\r\n  }\r\n\r\n}\r\n\r\n\r\nexport default GroupArchiveHelper;\r\n"],"mappings":"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"}